<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventário de Essências</title>
    <link rel="stylesheet" href="../styles/main.css">
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            font-family: 'PixelOperator', sans-serif;
            color: #ffffff;
        }

        .essence-container {
            max-width: 600px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: #6a4c93;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            margin-bottom: 30px;
        }

        .essence-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .essence-card {
            background: linear-gradient(135deg, #2a323e 0%, #1f2732 100%);
            border: 2px solid #6a4c93;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .essence-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(106, 76, 147, 0.4);
        }

        .essence-card img {
            width: 64px;
            height: 64px;
            image-rendering: pixelated;
            margin-bottom: 10px;
            filter: drop-shadow(0 0 10px rgba(106, 76, 147, 0.6));
        }

        .essence-name {
            font-size: 18px;
            font-weight: bold;
            color: #6a4c93;
            margin-bottom: 10px;
        }

        .essence-amount {
            font-size: 28px;
            color: #ffffff;
            margin-bottom: 15px;
        }

        .craft-button {
            background: linear-gradient(135deg, #6a4c93 0%, #533a71 100%);
            border: 2px solid #8b6fb0;
            border-radius: 5px;
            padding: 8px 15px;
            color: #ffffff;
            font-family: 'PixelOperator', sans-serif;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .craft-button:hover:not(:disabled) {
            background: linear-gradient(135deg, #533a71 0%, #6a4c93 100%);
            transform: scale(1.05);
        }

        .craft-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .craft-info {
            font-size: 12px;
            color: #aaaaaa;
            margin-top: 5px;
        }

        .close-button {
            display: block;
            margin: 20px auto 0;
            background: linear-gradient(135deg, #ff4444 0%, #cc0000 100%);
            border: 2px solid #ff6666;
            border-radius: 5px;
            padding: 10px 30px;
            color: #ffffff;
            font-family: 'PixelOperator', sans-serif;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .close-button:hover {
            background: linear-gradient(135deg, #cc0000 0%, #ff4444 100%);
            transform: scale(1.05);
        }

        /* Cores específicas por raridade */
        .essence-card[data-rarity="Comum"] {
            border-color: #808080;
        }
        .essence-card[data-rarity="Comum"] .essence-name {
            color: #808080;
        }

        .essence-card[data-rarity="Incomum"] {
            border-color: #4CAF50;
        }
        .essence-card[data-rarity="Incomum"] .essence-name {
            color: #4CAF50;
        }

        .essence-card[data-rarity="Raro"] {
            border-color: #2196F3;
        }
        .essence-card[data-rarity="Raro"] .essence-name {
            color: #2196F3;
        }

        .essence-card[data-rarity="MuitoRaro"] {
            border-color: #9C27B0;
        }
        .essence-card[data-rarity="MuitoRaro"] .essence-name {
            color: #9C27B0;
        }

        .essence-card[data-rarity="Epico"] {
            border-color: #FF9800;
        }
        .essence-card[data-rarity="Epico"] .essence-name {
            color: #FF9800;
        }

        .essence-card[data-rarity="Lendario"] {
            border-color: #FFD700;
        }
        .essence-card[data-rarity="Lendario"] .essence-name {
            color: #FFD700;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.6);
        }
    </style>
</head>
<body>
    <div class="essence-container">
        <h1>Inventário de Essências</h1>
        
        <div class="essence-grid" id="essence-grid">
            <!-- Cards de essência serão inseridos aqui -->
        </div>

        <button class="close-button" id="close-button">Fechar</button>
    </div>

    <script>
        const essenceGrid = document.getElementById('essence-grid');
        const closeButton = document.getElementById('close-button');

        const rarityOrder = ['Comum', 'Incomum', 'Raro', 'MuitoRaro', 'Epico', 'Lendario'];
        const rarityNames = {
            'Comum': 'Comum',
            'Incomum': 'Incomum',
            'Raro': 'Raro',
            'MuitoRaro': 'Muito Raro',
            'Epico': 'Épico',
            'Lendario': 'Lendário'
        };

        const CRAFT_COST = 10;

        async function loadEssences() {
            try {
                const inventory = await window.electronAPI.invoke('get-essence-inventory');
                console.log('Inventário de essências:', inventory);

                essenceGrid.innerHTML = '';

                rarityOrder.forEach((rarity, index) => {
                    const amount = inventory[rarity] || 0;
                    const canCraft = amount >= CRAFT_COST && index < rarityOrder.length - 1;
                    const nextRarity = index < rarityOrder.length - 1 ? rarityOrder[index + 1] : null;

                    const card = document.createElement('div');
                    card.className = 'essence-card';
                    card.setAttribute('data-rarity', rarity);
                    
                    card.innerHTML = `
                        <img src="../Assets/Icons/soul-essence.png" alt="${rarityNames[rarity]}">
                        <div class="essence-name">${rarityNames[rarity]}</div>
                        <div class="essence-amount">${amount}</div>
                        ${nextRarity ? `
                            <button class="craft-button" ${!canCraft ? 'disabled' : ''} data-rarity="${rarity}">
                                Criar ${rarityNames[nextRarity]}
                            </button>
                            <div class="craft-info">Custo: ${CRAFT_COST}x</div>
                        ` : '<div class="craft-info">Raridade Máxima</div>'}
                    `;

                    essenceGrid.appendChild(card);
                });

                // Adicionar eventos aos botões de craft
                document.querySelectorAll('.craft-button:not([disabled])').forEach(button => {
                    button.addEventListener('click', () => {
                        const rarity = button.getAttribute('data-rarity');
                        craftEssence(rarity);
                    });
                });

            } catch (err) {
                console.error('Erro ao carregar essências:', err);
            }
        }

        function craftEssence(fromRarity) {
            console.log('Craftando essência de:', fromRarity);
            window.electronAPI.send('craft-essence', fromRarity);
        }

        // Listeners para eventos de essência
        if (window.electronAPI?.on) {
            window.electronAPI.on('essence-crafted', (e, data) => {
                console.log('Essência craftada:', data);
                loadEssences(); // Recarregar inventário
            });

            window.electronAPI.on('essence-generated', (e, data) => {
                console.log('Essências geradas:', data);
                loadEssences();
            });

            window.electronAPI.on('essence-used', (e, data) => {
                console.log('Essência usada:', data);
                loadEssences();
            });

            window.electronAPI.on('craft-essence-error', (e, error) => {
                alert(error);
            });
        }

        closeButton.addEventListener('click', () => {
            window.electronAPI.send('close-essence-window');
        });

        // Carregar essências ao abrir a janela
        loadEssences();
    </script>
</body>
</html>
